# アプリケーション詳細設計

## 1. システムアーキテクチャ
- **フロントエンド**: React/Next.js（レスポンシブ対応、ダークモード対応）。Markdownエディタ: react-markdown-editor-lite。管理者ダッシュボード: 専用コンポーネント（リスト+ボタン）。
- **バックエンド**: Node.js with Express（APIサーバー）。DB: PostgreSQL (Neon無料ティア使用、低コスト/簡単マネージド）。
- **認証**: JWT (jsonwebtoken) with bcrypt。Google/GitHubログイン: passport.jsで実装（一般ライブラリ）。
- **ストレージ**: Cloudinary（画像アップロード、無料ティア）。
- **セキュリティ**: HTTPS (Let's Encrypt), CAPTCHA (Google reCAPTCHA無料), データ暗号化 (bcrypt for hash)。管理者操作: APIミドルウェアで制限。
- **デプロイ**: Next.jsフルスタック（API Routes使用）でVercelに統一（無料ティア、Git pushでデプロイ）。簡単で代替: GitHub ActionsでフロントVercel +バックRender/Heroku (無料ティア）。CI/CD: GitHub Actions（無料）。
- **コスト管理**: すべて無料ティアスタート。本番: Vercel Pro (月20ドル以内)、Neon Hobby (月5ドル)。

## 2. APIエンドポイント（RESTful例）
- **ユーザー**:
  - POST /api/users/register: 登録（メール/Google/GitHub）。
  - POST /api/users/login: ログイン。
  - GET /api/users/:id: プロファイル取得。
- **投稿**:
  - POST /api/posts: 新規投稿（type: article/prompt/conversation, タグ配列）。
  - GET /api/posts/:id: 詳細取得。
  - PUT /api/posts/:id: 編集。
  - DELETE /api/posts/:id: 削除。
  - GET /api/posts: リスト（クエリ: type, tag, sort=new/popular）。
- **検索**:
  - GET /api/search: キーワード/タグ検索（フィルター: type, sort）。
- **インタラクション**:
  - POST /api/likes: いいね追加。
  - POST /api/follows: フォロー。
  - POST /api/favorites: お気に入り追加。
  - GET /api/top: トップページ人気データ（いいね数ベース）。
- **管理者専用**:
  - GET /api/admin/users: ユーザー一覧（管理者認証必須）。
  - POST /api/admin/users: 新規ユーザー作成。
  - DELETE /api/admin/users/:id: ユーザー削除。
  - DELETE /api/admin/posts/:id: 投稿削除。
  - Middleware: req.user.is_admin === true でアクセス制御。

## 3. データフロー
- 投稿作成: フォーム入力 → バリデーション → DB保存 → タグ関連付け。
- 検索: クエリ → DB全文検索 (PostgreSQL tsquery) + タグフィルタ → 結果ソート。
- トップページ: キャッシュされた人気クエリ（いいね数降順）でセクション生成。
- 管理者操作: ダッシュボードロード → APIコール（ユーザー/投稿リスト） → 操作（作成/削除） → DB更新。

## 4. UIワイヤーフレーム概要（テキストベース）
- **トップページ**: ヘッダー（検索バー）、メイン: 横スライダー（全体人気カードリスト | 記事人気 | プロンプト人気 | 会話人気）。
- **投稿ページ**: タブ（記事/プロンプト/会話）、Markdownエディタ、タグ入力（サジェスト）、プラットフォーム選択（会話時ドロップダウン）。
- **検索結果**: リスト表示、左サイド: 折りたたみフィルター（タイプ/タグ）。
- **管理者ダッシュボード**: サイドメニュー（ユーザー管理/投稿管理）、メイン: テーブルリスト（ユーザー: ID/名/メール/削除ボタン、投稿: ID/タイトル/ユーザー/削除ボタン）。作成フォーム: ユーザー入力フィールド。

## 5. 追加資料の必要性
- 上記で基本カバー。必要ならワイヤーフレームツール（Figma）で詳細作成推奨だが、Markdown限界のためテキストベース。開発時はPrototypingツール使用。